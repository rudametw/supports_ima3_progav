\RequirePackage[l2tabu, orthodox]{nag}

%\documentclass[a4paper]{article}
%\documentclass[final, pdftex, a4paper, 12pt, openbib, ]{article}
\documentclass[final, a4paper, openbib, ]{article}
\usepackage[utf8]{inputenc}
\usepackage[francais]{babel}
%\usepackage{lmodern}
\usepackage[T1]{fontenc}
%\usepackage{graphicx}
\usepackage{alltt}
\usepackage{float}
%\usepackage{times}
%\usepackage{a4wide}
\usepackage{upquote,textcomp}
\usepackage{geometry}
%\usepackage{hyperref}
\usepackage[
%pdftex,
final,                      % if you do    want to have clickable-colorful links
pdfstartview = FitV,
linktocpage  = false,       % ToC, LoF, LoT place hyperlink on page number, rather than entry text
breaklinks   = true,        % so long urls are correctly broken across lines
% pagebackref  = false,     % add page number in bibliography and link to position in document where cited
]{hyperref}
\usepackage{mathtools}
\geometry{a4paper, portrait, margin=2cm}
%\addtolength{\textheight}{2 cm}
%\addtolength{\oddsidemargin}{-1cm}
%\addtolength{\topmargin}{-1cm}
%\addtolength{\textwidth}{1 cm}

%Good solution for monospaces
%\usepackage{pxfonts} % Or palatino or mathpazo, changes all fonts to something sans
%\usepackage{eulervm} % only changes math fonts, i checked
%\usepackage[ttdefault=true]{AnonymousPro} %Only changes tt fonts
% WHICH ONE TO CHOOSE?
\usepackage{pslatex}
%\usepackage[ttdefault=true]{AnonymousPro} %Only changes tt fonts
% \usepackage[varg, cmintegrals, cmbraces, ]{newtxtext,newtxmath} % libertine, uprightGreek (U.S.) or slantedGreek (ISO), 
% \usepackage{tgtermes}
% \usepackage{txfonts}
% \usepackage{mathptmx}
% \usepackage[scaled=.90]{helvet}
% \usepackage{courier}
% \usepackage{textcomp}     % required for special glyphs
% \usepackage{bm}   


\usepackage{caption}
\captionsetup[figure]{labelformat=empty}% redefines the caption setup of the figures environment in the beamer class.

%Inconsoloata, a little too light.
%\usepackage{inconsolata}
%\renewcommand{\ttdefault}{Consolas}
%\usepackage{fontspec} %Doesn't work with pdflatex
%\setmonofont{Consolas}



%\renewcommand*\familydefault{\ttdefault} %% Only if the base font of the document is to be typewriter style

%\newcommand\Fontvi{\fontsize{6}{7.2}\selectfont}

%Make tabularx center cells vertically
%\def\tabularxcolumn#1{m{#1}}
%\renewcommand{\tabularxcolumn}[1]{>{\small}m{#1}}

%%Syntax hilighting
%\usepackage{fancyvrb}
\usepackage{minted}
%\usepackage[newfloat]{minted}
\usemintedstyle{borland}
%\usepackage{etoolbox}
%\AtBeginEnvironment{minted}{\singlespacing%
%	\fontsize{14}{14}\selectfont}
%\newminted{java}{fontsize=\footnotesize}
\usepackage{caption}

%\usepackage{multicol}
%\usepackage{vwcol}
%\usepackage{lipsum}
%\usepackage{microtype}
%\setlength{\columnseprule}{0.4pt}
%\renewcommand{\columnseprulecolor}{\color{red}}
\newcommand{\BAD}[1]{{\color{red}#1}}
\newcommand{\GOOD}[1]{{\color{darkgreen}#1}}


\usepackage{graphicx}
\usepackage{colortbl,array}
\usepackage{tabularx}
\definecolor{warningbackground}{RGB}{252,226,158}

\newcommand{\alertwarningbox}[1]{
    \centering
    \begin{tabularx}{0.9\linewidth}{
        >{\columncolor{warningbackground}}c
        >{\columncolor{warningbackground}}X}
        \raisebox{\dimexpr2\baselineskip-\height}
        {\includegraphics[scale=0.8]{attention.pdf}}&
        \raisebox{\tabcolsep}{\strut}#1\raisebox{-\tabcolsep}{\strut}
    \end{tabularx}
}


\usepackage{xcolor}

%\definecolor{infobackground}{RGB}{217,237,247}
%\definecolor{infoforeground}{RGB}{58,135,173}
%\definecolor{infoborder}{RGB}{188,232,241}

\definecolor{infobackground}{RGB}{217,237,247}
\definecolor{infoforeground}{RGB}{30,50,70}
\definecolor{infoborder}{RGB}{30,50,70}

\definecolor{infobackground}{RGB}{217,237,247}
\definecolor{infoforeground}{RGB}{30, 80, 150}
\definecolor{infoborder}{RGB}{47, 87, 232}


\usepackage{environ}
\usepackage{tikz}
\usetikzlibrary{fit,backgrounds,calc}

\NewEnviron{alertinfo}[1]
{
\begin{center}
    \begin{tikzpicture}
    \node[inner sep=0pt,
          draw=infoborder,
          line width=1pt,
          fill=infobackground] (box) {\parbox[t]{0.99\textwidth}
        {%
            \begin{minipage}{.12\textwidth}
                \centering\tikz[scale=3]
                \node[scale=1]
                {
                    \includegraphics[scale=0.25]{\images/information.pdf}
                };
            \end{minipage}%
           \begin{minipage}{.86\textwidth}
                \vskip 10pt
                \textbf{\textcolor{infoforeground}{\large #1}}\par\smallskip
                \textcolor{infoforeground}{\large \BODY}
                \par\smallskip
                \par\smallskip
            \end{minipage}\hfill
        }%
    };
    \end{tikzpicture}
\end{center}
}

\usepackage{titling}


\newcommand{\codes}{../codes/TP2}
\newcommand{\images}{../images}


%\title{GBIAAL 4$^{\mbox{\`eme}}$ année \\ Devoir Surveillé --- Base de données \\ 13 janvier 2016  \\ 1 heure}
\title{IMA 3$^{\mbox{\`eme}}$ année\\ Programmation Avancé
	%\\TP1 Structures, Listes contiguës, Redirections}
}
\author{\huge \textbf{TP2 Listes contiguës, Fichiers}}
\setlength{\parindent}{0pt}
\pagestyle{empty}
\date{}


\begin{document}
%\vspace{-15cm}
\posttitle{\par\end{center}}
\setlength{\droptitle}{-45pt}
\maketitle
%\thispagestyle{empty}

%\section{Schéma conceptuel}
\vspace{-1.7cm}
\section{Objectifs}

\begin{itemize}
	\item Savoir utiliser les listes contiguës en C.
	\item Utiliser les opérations de lecture et d'écriture sur les fichiers en C.
	\item Utiliser les arguments de la ligne de commande.
\end{itemize}

%\textbf{Contexte et préparation : } Le contexte de ce TP est le même que celui du TP1, à savoir une application de gestion d'annuaire.

\paragraph{Contexte et préparation : } Le contexte de ce TP est le même que celui du TP1, à savoir une application de gestion d'annuaire.

\begin{alertinfo}{IMPORTANT !}
	Ce TP utilise les types de données et les fonctions du TP1.
\end{alertinfo}


\paragraph{Avant de commencer}
\begin{itemize}
\item Créer un répertoire TP2 dans votre répertoire de PA et y copier les fichiers \texttt{entiers.txt}, \texttt{annu.txt} et votre \texttt{.c} du TP précédent (renommez ce dernier en \texttt{tp2.c}).
\item Récupérer sur le compte de Walter Rudametkin, les fichiers \texttt{moyenne\_fichier.c} et \texttt{ldc.c} présents à l'adresse : \url{~wrudamet/public/IMA3/TP2/}
\end{itemize}


\section{Questions du TP \large (à faire impérativement)}

\subsection{Chargement à partir d'un fichier}

La version demandée dans le précédent TP ne permet pas les opérations interactives sur l'annuaire, l'entrée standard étant redirigée pour le chargement des données. Pour libérer l'entrée standard, nous allons donc manipuler explicitement le fichier de données en C.

\begin{enumerate}
	\item  En vous inspirant de l'exemple \texttt{moyenne\_fichier.c}, écrire une nouvelle fonction de chargement de l'annuaire qui permet de lire les données à partir d'un fichier texte dont le pointeur est passé en paramètre. Pour cela, on commencera par modifier la
	fonction de lecture d'une personne. Tester à partir du \texttt{main}, en ouvrant le fichier
	avec : \\
	\texttt{FILE *fp ;}\\
	\texttt{fp = fopen("annu.txt", "r") ;}
	
	\item Utiliser les paramètres de la fonction \texttt{main} pour vérifier que l'argument a été correctement fourni au lancement et récupérer le nom du fichier de données passé en argument (voir l'exemple \texttt{ldc.c}). À ce stade, le lancement de votre programme annuaire doit se faire de la façon suivante : \texttt{./annuaire annu.txt}	
\end{enumerate}


\subsection{Recherche dans l'annuaire}
Dans cette partie, il faut que l'annuaire soit trié selon les noms des personnes. Si vous
n'avez pas écrit de fonction de tri dans le premier TP, modifiez le fichier \texttt{annu.txt} pour qu'il soit trié par nom.
\paragraph{Remarque :} La recherche dichotomique dans un tableau trié est un algorithme classique vu en TD.

\begin{enumerate}
	\item Écrire une fonction \texttt{rech\_dicho} qui prend en paramètre un nom de personne et un annuaire, effectue une recherche dichotomique de cette personne dans l'annuaire
	et retourne l'indice de rangement de la personne dans la liste contiguë si elle est
	présente, \texttt{-1} sinon.
	\item Tester la fonction \texttt{rech\_dicho} en demandant un nom de personne à l'utilisateur et en affichant après le retour de la fonction les informations trouvées (nom, prénom, date de naissance, numéro de téléphone) ou \textit{inconnu} sinon.
\end{enumerate}

\subsection{Modification de l'annuaire et sauvegarde dans un fichier}

\begin{enumerate}
	\item Écrire une fonction qui donne la possibilité à l'utilisateur de modifier le numéro de téléphone d'une personne recherchée dans l'annuaire comme précédemment.
	Tester la fonction.
	\item L'annuaire pouvant être modifié, écrire une fonction permettant de sauvegarder l'annuaire dans un (autre) fichier texte, selon le même format que celui du fichier \texttt{annu.txt} donnée en argument.
\end{enumerate}


\section{Questions s’il vous reste du temps}

On va faire un joli menu pour l'application annuaire :

\begin{enumerate}
	\item Écrire une fonction menu qui propose à l'utilisateur les différentes fonctionnalités possibles de l'application (affichage de l'annuaire, recherche d'une personne, modification du numéro de téléphone d'une personne donnée, quitter l'application avec ou sans sauvegarde de l'annuaire) et qui retourne le choix de l'utilisateur.
	\item Modifier la fonction \texttt{main} de l'application pour afficher le menu utilisateur et effectuer le traitement correspondant au choix de l'utilisateur.
	\item N'oubliez pas de boucler sur le menu jusqu'à ce que l'utilisateur demande de quitter l'application.
\end{enumerate}


\section{Annexes}
\vspace{-0.5cm}
\begin{figure}[!h]
	\begin{minipage}[c]{0.40\textwidth}
		\centering
		\inputminted[
		%frame=lines,
		%framesep=2.5mm,
		%baselinestretch=0.8,
		fontsize=\small,
		linenos,
		tabsize=2,
		breaklines,
		xleftmargin=-25pt,
		numbersep=7pt,		
		%firstline=14,lastline=28
		%bgcolor=light-gray
		]
		{c}{\codes/ldc.c}
		\caption{\texttt{ldc.c}}
	\end{minipage}
	\hspace{0.1cm}
	\vrule{}
	\hspace{0.3cm}
	\begin{minipage}[c]{0.62\textwidth}
%		\centering
		\inputminted[
		%frame=lines,
		%framesep=2.5mm,
		%baselinestretch=0.8,
		fontsize=\small,
		linenos,
		tabsize=4,
		breaklines,
		xleftmargin=4pt,
		numbersep=7pt,
%		breaksymbolleft=,
		%firstline=14,lastline=28
		%bgcolor=light-gray
		]
		{c}{\codes/moyenne_fichier.c}
		\centering
%		\captionof{listing}{entiers.txt}
%		\captionsetup[justification=justified,singlelinecheck=false]
%		\captionsetup{justification=raggedright, singlelinecheck=false}
		\caption{\texttt{moyenne\_fichier.c}}
	\end{minipage}
%	\hspace{-1cm}
%	\vrule{}
%	\hspace{0.6cm}
%	\begin{minipage}[b]{0.15\textwidth}
%		\centering
%		\inputminted[
%		%frame=lines,
%		%framesep=2.5mm,
%		%baselinestretch=0.8,
%		fontsize=\small,
%		linenos,
%		tabsize=2,
%		%firstline=14,lastline=28
%		%bgcolor=light-gray
%		]
%		{c}{\codes/moyenne_fichier.c}
%		\captionsetup{justification=raggedright, singlelinecheck=false}
%		\caption{annu.txt}
%	\end{minipage}
%	\captionof{listing}{SomeCaption}
%	\label{lst:representation_examples}
\end{figure}
\end{document}